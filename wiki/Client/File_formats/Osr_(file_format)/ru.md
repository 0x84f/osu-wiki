# .osr (формат файла)

**.osr** - это формат файла, содержащий информацию о реплее osu!. Для его запуска карта, указанная в файле, должна находиться в папке "Songs".

## Типы данных

| Название | Размер | Описание |
| :-- | :-- | :-- |
| Byte | 1 | 8-битное значение |
| Short | 2 | 2-байтовое значение с прямым порядком байтов |
| Integer | 4 | 4-байтовое значение с прямым порядком байтов |
| Long | 8 | 8-байтовое значение с прямым порядком байтов |
| ULEB128 | Любой | Целое число переменной длины [ULEB128](http://en.wikipedia.org/wiki/ULEB128) |
| String | Любой | Состоит их трех частей: Первая часть имеет тип Byte и равна 0x00 (указывает, что следующие две части отсутствуют) или 0x0b (указывает, что следующие две части присутствуют). Если это 0x0b, тогда во второй части будет [ULEB128](http://en.wikipedia.org/wiki/ULEB128), представляющий длину третьей части в байтах, а затем сама строка, закодированная в [UTF-8](http://en.wikipedia.org/wiki/UTF-8) |

## Формат файла

Байтовые смещения не включены в эту таблицу из-за значений переменной длины.

| Тип данных | Описание |
| :-- | :-- |
| Byte | Игровой режим реплея (0 = osu!, 1 = osu!taiko, 2 = osu!ctb, 3 = osu!mania) |
| Integer | Версия игры на момент создания повтора (например 20131216) |
| String | osu! MD5 хеш карты |
| String | Имя игрока |
| String | osu! MD5 хеш реплея (включает в себя некоторые свойства реплея) |
| Short | Число попаданий в "300" |
| Short | Число попаданий в "100" в osu!, "150" в osu!taiko, "100" в osu!ctb, "100" в osu!mania |
| Short | Число попаданий в "50" в osu!, в маленький фрукт в osu!ctb, в "50" в osu!mania |
| Short | Число попаданий в "Gekis" в osu!, в максимальные "300" в osu!mania |
| Short | Число попаданий в "Katus" в osu!, "200" в osu!mania |
| Short | Число промахов |
| Integer | Суммарное число полученных очков |
| Short | Самое большое набранное комбо |
| Byte | Идеально/полное комбо (1 = без промахов и досрочно законченных слайдеров)
| Integer | Используемые моды. Ниже приведен список значений |
| String | Данные полоски здоровья: разделенные запятыми пары u/v, где u — это время в миллисекундах в песне, а v — значение с плавающей запятой от 0 до 1, которое представляет количество здоровья, которое у вас есть в данный момент времени (0 = полоска здоровья пуста, 1 = полоска здоровья заполнена) |
| Long | Отметка времени ([Windows ticks](http://msdn.microsoft.com/en-us/library/system.datetime.ticks%28v=vs.110%29.aspx)) |
| Integer | Длина в байтах сжатых данных реплея |
| Byte Array | Сжатые данные реплея |
| Long | Онлайн идентификатор результата |
| Double | Дополнительная информация о модах. Существует только при включенном [Target Practice](/wiki/Game_modifier/Target_Practice) моде |

**Дополнительная информация о модах:**

| Мод | Описание |
| :-- | :-- |
| Target Practice | Суммарная точность всех попаданий. Разделите её на количество целей на карте, чтобы узнать точность, отображаемую в игре |

Остальные данные содержат информацию о движении мыши и нажатиях клавиш в потоке данных [LZMA](https://en.wikipedia.org/wiki/Lempel–Ziv–Markov_chain_algorithm).

При распаковке текст содержит данные, разделенные запятыми. Каждая часть обозначает действие, представленное 4 числами в виде: `w | x | y | z.`

| Число | Тип данных | Описание |
| :-- | :-- | :-- |
| w | Long | Время в миллисекундах с момента предыдущего действия |
| x | Float | координата Х курсора из диапазона 0 - 512 |
| y | Float | координата Y курсора из диапазона 0 - 384 |
| z | Integer | Побитовая комбинация нажатых клавиш/кнопок мыши (M1 = 1, M2 = 2, K1 = 4, K2 = 8, Smoke = 16) (K1 всегда используется с M1; K2 всегда используется с M2: 1+4=5; 2+8=10) |

В реплеях, установленных в версии `20130319` и позднее, 32-битное случайное целое число, используемое для оценки, будет закодировано в дополнительный кадр реплея в конце потока данных LZMA в формате `-12345|0|0|seed`.

## Моды

Указаны согласно [osu! API](https://github.com/peppy/osu-api/wiki#mods).

| Мод | Значение (Битовый сдвиг) | Примечание |
| :-- | :-- | :-- |
| None | 0 |  |
| NoFail | 1 (0) |  |
| Easy | 2 (1) |  |
| TouchDevice | 4 (2) | Заменяет неиспользуемый мод NoVideo |
| Hidden | 8 (3) |  |
| HardRock | 16 (4) |  |
| SuddenDeath | 32 (5) |  |
| DoubleTime | 64 (6) |  |
| Relax | 128 (7) |  |
| HalfTime | 256 (8) |  |
| Nightcore | 512 (9) | Всегда используется вместе с DT: 512 + 64 = 576 |
| Flashlight | 1024 (10) |  |
| Autoplay | 2048 (11) |  |
| SpunOut | 4096 (12) |  |
| Relax2 | 8192 (13) | Autopilot |
| Perfect | 16384 (14) |  |
| Key4 | 32768 (15) |  |
| Key5 | 65536 (16) |  |
| Key6 | 131072 (17) |  |
| Key7 | 262144 (18) |  |
| Key8 | 524288 (19) |  |
| keyMod | 1015808 | k4+k5+k6+k7+k8 |
| FadeIn | 1048576 (20) |  |
| Random | 2097152 (21) |  |
| LastMod | 4194304 (22) | Cinema |
| TargetPractice | 8388608 (23) | Только в версии игры osu!cuttingedge |
| Key9 | 16777216 (24) |  |
| Coop | 33554432 (25) |  |
| Key1 | 67108864 (26) |  |
| Key3 | 134217728 (27) |  |
| Key2 | 268435456 (28) |  |
| ScoreV2 | 536870912 (29) |  |
| Mirror | 1073741824 (30) |  |
